# 飞书多维表格API权限配置指导

## 问题现象
API调用返回 `91403 Forbidden` 错误，即使在飞书开放平台已经配置了相关权限。

## 解决方案

### 1. 飞书开放平台权限配置
确保在飞书开放平台已配置以下权限：
- `bitable:app` - 多维表格应用权限
- `bitable:app:readonly` - 多维表格只读权限  
- `bitable:record` - 多维表格记录权限
- `bitable:record:write` - 多维表格记录写入权限

**重要：权限配置后需要发布新版本才能生效！**

### 2. 多维表格文档权限配置 ⭐️ 关键步骤
这是最容易被忽略但最重要的步骤：

1. **打开目标多维表格**
2. **点击左上角「...」按钮**
3. **选择「更多」→「添加文档应用」**
4. **搜索并添加你的应用**（应用ID: `cli_a84049866cf9900d`）
5. **设置应用权限为「可编辑」**

### 3. 权限验证步骤

#### 步骤1：检查开放平台权限
```bash
# 访问飞书开放平台
https://open.feishu.cn/
# 进入应用 → 权限管理 → 确认权限已开通并发布
```

#### 步骤2：检查文档应用权限
```bash
# 在多维表格中
多维表格 → 左上角「...」→ 更多 → 添加文档应用 → 添加你的应用
```

#### 步骤3：测试API调用
```bash
python simple_feishu_test.py
```

## 常见错误码说明

| 错误码 | 说明 | 解决方案 |
|--------|------|----------|
| 91403 | Forbidden - 权限被拒绝 | 检查文档应用权限配置 |
| 99991672 | 缺少API权限 | 在开放平台添加相关权限并发布 |
| 99992402 | fields is required | 检查请求体格式 |

## 权限配置检查清单

- [ ] 飞书开放平台权限已配置
- [ ] 权限配置后已发布新版本
- [ ] 多维表格中已添加文档应用
- [ ] 应用权限设置为「可编辑」
- [ ] API调用格式正确
- [ ] 使用正确的字段名或field_id

## 测试脚本

使用 `simple_feishu_test.py` 进行权限测试：

```python
# 测试基本读取权限
✅ 令牌获取成功
✅ 应用读取正常  
❌ 写入权限被拒绝 → 需要配置文档应用权限

# 配置完成后应该看到：
✅ 令牌获取成功
✅ 应用读取正常
✅ 写入权限正常
```

## 注意事项

1. **双重权限控制**：飞书API需要同时满足开放平台权限和文档应用权限
2. **权限生效时间**：开放平台权限需要发布版本后生效，文档应用权限立即生效
3. **权限范围**：文档应用权限是针对具体多维表格的，每个表格都需要单独配置